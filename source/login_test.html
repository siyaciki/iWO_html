<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true
			});
		</script>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">乘务登录</h1>
		</header>
		<div class="mui-content">
			<form id="form" class="mui-input-group">
				<div class="mui-input-row">
					<label>用户名</label>
					<input id="username" type="text" class="mui-input-clear" name="username" placeholder="用户名" autofocus="autofocus" maxlength="8">
				</div>
				<div class="mui-input-row">
					<label>密码</label>
					<input id="password" type="password" class="mui-input-clear" name="password" placeholder="密码" maxlength="20">
					<input id="mac" type="hidden" class="mui-input-clear" name="mac" value="123123123">
				</div>
				<div id="macs">asd</div>
				<div class="" style="text-align: center;">
					<button type="button" id="send" class="mui-btn mui-btn-blue">登录</button>
					<button type="button" id="jiu" class="mui-btn mui-btn-green">主页九宫格</button>
					<button type="button" id="jiu2" class="mui-btn mui-btn-blue">屏幕切换</button>
				</div>
				<div id="asd">dizhi</div>
			</form>
		</div>
	</body>
	<script src="../js/jquery-1.8.0.js"></script>
	<script type="text/javascript">
		function findStr(str, n) {
			var temp = 0;
			for(var i = 0; i < str.length; i++) {
				if(str.charAt(i) == n) {
					temp++;
				}
			}
			return temp;
		}

		function getMac() {
			var mac = "xxx-xxx-xxx-xxx";
			if(plus.os.name == "Android") {
				//WifiManager 
				var Context = plus.android.importClass("android.content.Context");
				var WifiManager = plus.android.importClass("android.net.wifi.WifiManager");
				var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);
				var WifiInfo = plus.android.importClass("android.net.wifi.WifiInfo");
				var wifiInfo = wifiManager.getConnectionInfo();
				mac = wifiInfo.getMacAddress();
			}
			return mac;
		}
		function plusReady() {
			var macs = getMac();
			$("#macs").text(macs);
		}
		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}

		//jQuery(function() {
			$("#mac").val($("#macs").text());
			$("#send").hide();
			var addr = localStorage.server_url;
			$("#asd").text(addr);
			jQuery("#send").click(function() {
				var cont = jQuery("input").serialize();
				jQuery.ajax({
					url: 'http://192.168.1.112/index.php?m=Home&c=Auth&a=login',
					type: 'post',
					dataType: 'json',
					data: cont,
					async: false,
					success: function(data) {
						if(data.code==1){
							
							mui.openWindow({
								url: 'index.html',
								id: 'index.html',
							});
						}else{
							mui.toast("用户密码错误");
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						var str = "用户名密码错误" + XMLHttpRequest.status + "---" + XMLHttpRequest.readyState + textStatus + "naiyo" + XMLHttpRequest.responseText;
						mui.toast(str);
					}
				});
			});
			document.getElementById('jiu').addEventListener('tap', function() {
				mui.toast("跳转主页");
				mui.openWindow({
					url: 'index.html',
					id: 'index_id'
				});
			});
			document.getElementById('jiu2').addEventListener('tap', function() {
				mui.openWindow({
					url: 'htmls.html',
					id: 'htmls_id'
				});
			});
			var name_state = false;
			var psw_state = false;
			var re_n = /[^\d]/g;
			var re_t = /[^a-zA-Z]/g;
			var oName = document.getElementById("username");
			oName.onblur = function() {
				var m = findStr(this.value, this.value[0]);
				if(this.value == "") {
					mui.toast("用户名不能为空");
					name_state = false;
				} else if(m == this.value.length) {
					mui.toast("用户名不能为相同字符");
					name_state = false;
				} else if(this.value.length < 2) {
					mui.toast("用户名长度应为3-8个字符");
					name_state = false;
				} else {
					name_state = true;

				}
			}
			oName.oninput = function() {
				if(this.value.length > 3 && psw_state) {
					$("#send").show();
				} else {
					$("#send").hide();
				}
			}

			var psw = document.getElementById("password");
			psw.onblur = function() {

				//不能为空 不能相同字符 长度6-16 不能全数字 不能全字母 
				var m = findStr(psw.value, psw.value[0]);
				if(psw.value == "") {
					mui.toast("密码不能为空");
					psw_state = false;
				} else if(m == psw.value.length) {
					mui.toast("密码不能为相同字符");
					psw_state = false;
				} else if(psw.value.length < 6) {
					mui.toast("密码长度应为6-10个字符");
					psw_state = false;
					//				} else if(!re_n.test(psw.value)) {
					//					mui.toast("密码不能全部为数字");
					//					psw_state = false;
					//				} else if(!re_t.test(psw.value)) {
					//					mui.toast("密码不能全部为字母");
					//					psw_state = false;
				} else {
					psw_state = true;
				}

			}
			psw.oninput = function() {
				if(this.value.length > 5 && name_state) {
					$("#send").show();
				} else {
					$("#send").hide();
				}
			}

	//	});
	</script>

</html>